/*! ThreeDCharts.JS | mphennum.com | mphennum@gmail.com */
var THREEDCHARTS=THREEDCHARTS||{VERSION:"0.2",DATE:"2013-05-05",WEBSITE:"http://mphennum.com/work/threedcharts/",CAMERADISTANCE:17,MONTH:["January","February","March","April","May","June","July","August","September","October","November","December"],COLORSCHEMES:{basic:{bg:7371903,border:2437179,marks:16777215,titles:16777215,colors:[2122414,4629823,13572669,15521313,7086464,14255111,13983346,7294776,15329769,8358795,44226,6389059,14434226,13913890,13609626,12440646]},basic2:{bg:7829367,border:3355443,marks:16777215,titles:16777215,colors:[11673397,30010,21157,16774965,6823550,16752949,11673397,30010,21157,16774965,6823550,16752949]},earth:{bg:9011564,border:2693129,marks:16777215,titles:16777215,colors:[4214564,6370072,9386779,5136754,8481883,6720828,8738595,13989120,8622751,12164203,12439711,14404201]},warm:{bg:13407530,border:8197378,marks:16777215,titles:16777215,colors:[15544869,16766003,16735235,16771184,16748815,16601669,16774147,16755715,11350565,16761103]},cool:{bg:7576472,border:1388576,marks:16777215,titles:16777215,colors:[7243776,4749939,9806906,7180674,11187826,6660754,10401840,7908003,12969066,10338738]},neon:{bg:1579032,border:526344,marks:16777215,titles:16777215,colors:[2555648,16711935,16318208,65023,16758784,10944256,16744703,16318336,8453631,16777215]},bluegray:{bg:7501433,border:2173232,marks:16777215,titles:16777215,colors:[12830925,7765896,11054516,6318708,3226438,11778237,5266020,10001828,4279126,8818584]},gray:{bg:7829367,border:3355443,marks:16777215,titles:16777215,colors:[16777215,10526880,15790320,9474192,14737632,8421504,13684944,7368816,12632256,6316128,11579568,5263440]},custom:{bg:7829367,border:3355443,marks:16777215,titles:16777215,colors:[16711680,65280,255]}},LIGHTDEPTH:10,PLANETHICKNESS:0.05,LINETHICKNESS:0.05,JOINTTHICKNESS:0.025,POINTSIZE:0.035,CHARTSIZE:10};THREEDCHARTS.chartFactory=function(b,a){switch(b){case"scatter":return new THREEDCHARTS.ScatterChart({controller:a});case"bar":return new THREEDCHARTS.BarChart({controller:a});case"line":return new THREEDCHARTS.LineChart({controller:a});default:return null}};THREEDCHARTS.ThreeDChart=function(b){var c=this;function a(){b=b||{};c.webgl=Detector.webgl;c.file=b.file||false;c.files=b.files||[];c.json=b.json||{};if(c.files.length>0){c.file=c.files[0]}else{if(c.file){c.files[0]=c.file}}if(b.gui){c.gui={legend:b.gui.legend||true,tools:b.gui.tools||true,size:b.gui.size||1}}else{c.gui={legend:true,tools:true,size:1}}c.id=b.id||false;c.fullscreen=b.fullscreen||false;if(c.fullscreen){c.width=innerWidth;c.height=innerHeight;document.body.style.margin="0";document.body.style.padding="0";document.body.style.overflow="hidden"}else{c.width=b.width||innerWidth;c.height=b.height||innerHeight}if(b.colorscheme==="custom"){c.colorscheme=b.customcolorscheme||THREEDCHARTS.COLORSCHEMES.basic}else{if(!b.colorscheme||!THREEDCHARTS.COLORSCHEMES[b.colorscheme]){c.colorscheme=THREEDCHARTS.COLORSCHEMES.basic}else{c.colorscheme=THREEDCHARTS.COLORSCHEMES[b.colorscheme]}}if(b.border){c.border={back:b.border.back===false?false:true,side:b.border.side===false?false:true,bottom:b.border.bottom===false?false:true,color:c.colorscheme.border}}else{c.border={back:true,side:true,bottom:true,color:c.colorscheme.border}}if(b.titles){c.titles={main:b.titles.main===false?false:true,x:b.titles.x===false?false:true,y:b.titles.y===false?false:true}}else{c.titles={main:true,x:true,y:true}}if(b.marks){c.marks={x:b.marks.x===false?false:true,y:b.marks.y===false?false:true}}else{c.marks={x:true,y:true}}c.autoinit=b.init||false;c.initialized=false;if(c.autoinit===true){c.init()}}c.init=function(){if(c.file){c.setJSONFromFile(c.file)}else{if(c.initialized){c.chart=THREEDCHARTS.chartFactory(c.json.type,c)}else{var d;c.initialized=true;c.container=c.id===false?document.body:document.getElementById(c.id);d=c.container.getAttribute("class")||"";if(d){d+=" "}c.container.setAttribute("class",d+"threedchart");c.container.style.width=c.width+"px";c.container.style.height=c.height+"px";c.renderer=c.webgl?new THREE.WebGLRenderer({antialias:true}):new THREE.CanvasRenderer();c.renderer.setSize(c.width,c.height);c.container.appendChild(c.renderer.domElement);c.renderer.setClearColorHex(c.colorscheme.bg,1);c.renderer.clear();c.renderer.shadowMapEnabled=true;c.renderer.shadowMapSoft=true;c.canvas=c.renderer.domElement;c.camera=new THREE.PerspectiveCamera(45,c.width/c.height,1,1000);c.cameradistance=b.cameradistance||17;c.scene=new THREE.Scene();c.chart=THREEDCHARTS.chartFactory(c.json.type,c);c.update()}}};c.loadFile=function(d){c.file=c.files[d];c.controls.gui.legend.clear();c.chart.clear();c.init()};c.setJSONFromFile=function(d){var e;if(window.XMLHttpRequest){e=new XMLHttpRequest()}else{if(window.ActiveXObject){e=new ActiveXObject("Microsoft.XMLHTTP")}}e.open("GET",d,true);e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.onreadystatechange=function(){if(e.readyState==4&&e.status==200){c.json=JSON.parse(e.responseText);c.file=false;c.init()}};e.send()};c.setupControls=function(d){c.chart=d||c.chart;if(c.controls){c.controls.gui.setLegend({controller:c,gui:c.gui})}else{c.controls=new THREEDCHARTS.Controls({controller:c,gui:c.gui})}};c.setCameraDistance=function(d){c.cameradistance=d;c.fixCamera();c.resetCamera()};c.fixCamera=function(){if(c.width/c.height<1){c.cameradistance*=c.height/c.width}};c.resetCamera=function(){c.camera.position.x=0;c.camera.position.y=0;c.camera.position.z=c.cameradistance;c.controls.setRadius(c.cameradistance)};c.update=function(){c.camera.lookAt({x:0,y:0,z:0});c.renderer.render(c.scene,c.camera)};a()};THREEDCHARTS.BarChart=function(b){THREEDCHARTS.Chart.call(this,b);var c=this;function a(){c.setupJSON();c.setupVars();c.setupScene();c.addItems();c.setupControls()}c.setupMinMax=function(){var e,d,f;c.min={x:0,y:0};c.max={x:0,y:0};c.range={x:0,y:0};c.mod={x:0,y:0};d=c.itemvars.length;c.max.x=d;if(d&&c.itemvars[0].value){c.min.y=c.max.y=c.itemvars[0].value}c.maxvlen=1;for(e=0;e<d;e++){f=c.itemvars[e].value;c.min.y=Math.min(f,c.min.y);c.max.y=Math.max(f,c.max.y)}if(c.start.y!==false&&c.start.y<c.min.y){c.min.y=c.start.y}if(c.end.y!==false&&c.end.y>c.max.y){c.max.y=c.end.y}};c.addBorders=function(){var f=THREEDCHARTS.LINETHICKNESS*2,d={x:c.range.x*c.scale.x,y:c.range.y*c.scale.y},e=c.itemvars.length;if(c.border.back){c.addNode(new THREEDCHARTS.Plane({controller:c.controller,width:d.x+f,height:d.y+f,z:-c.increment.z,color:c.border.color}))}if(c.border.side){c.addNode(new THREEDCHARTS.Plane({controller:c.controller,direction:"y",width:c.increment.z*7,height:d.y+f,x:-0.5*d.x-THREEDCHARTS.LINETHICKNESS,z:0.5*(c.increment.z*7-THREEDCHARTS.PLANETHICKNESS),color:c.border.color}))}if(c.border.bottom){c.addNode(new THREEDCHARTS.Plane({controller:c.controller,direction:"x",width:d.x+THREEDCHARTS.PLANETHICKNESS*2.5,height:c.increment.z*7,x:-0.25*THREEDCHARTS.PLANETHICKNESS,y:-0.5*d.y-THREEDCHARTS.LINETHICKNESS,z:0.5*(c.increment.z*6-THREEDCHARTS.PLANETHICKNESS),color:c.border.color}))}};c.addMarks=function(){var g,e,d,j,h,f=c.itemvars.length;h=c.increment.z*3.5;if(c.marks.y){e=c.range.y/c.increment.y;g=10/e;for(i=0;i<=e;i++){j=i*g-5;c.addMark({x:-5.175,y:j,z:h,endx:-5.075,endy:j,endz:h,color:c.colorscheme.marks});c.addTitle(c.getFormattedTitle(i,"y"),"right",{x:-5.3,y:j,z:h},0.15,0,c.colorscheme.titles)}}};c.addItems=function(){var j,h,f,m,l,d,g,e;h=c.itemvars.length;g=20/(3*h+1);e=g-THREEDCHARTS.CHARTSIZE*0.5;d=[];f=0;for(j=0;j<h;j++){m={controller:c.controller,name:c.itemvars[j].name,values:[{x:j*g*1.5+e,y:0.5*(-THREEDCHARTS.CHARTSIZE+c.itemvars[j].value*c.scale.y),z:c.increment.z*4}],width:g,height:c.itemvars[j].value*c.scale.y};l=c.itemvars[j].group||m.name;if(d[l]===undefined){d[l]=c.colorscheme.colors[f%c.colorscheme.colors.length];f++}m.values.color=d[l];c.addItem(new THREEDCHARTS.BarItem(m),l)}};a()};THREEDCHARTS.Chart=function(b){var c=this;function a(){c.controller=b.controller;c.container=c.controller.container;c.files=c.controller.files;c.json=c.controller.json;c.scene=c.controller.scene;c.camera=c.controller.camera;c.colorscheme=c.controller.colorscheme;c.border=c.controller.border;c.marks=c.controller.marks;c.titles=c.controller.titles;c.width=c.controller.width;c.height=c.controller.height;c.nodes=[];c.items=[];c.groups=[];c.light=new THREEDCHARTS.Light({controller:c.controller});c.addNode(c.light)}c.setupJSON=function(){if(c.json.title){c.title={main:c.json.title.main||"",x:c.json.title.x||"",y:c.json.title.y||""}}else{c.title={main:"",x:"",y:""}}c.scale={x:1,y:1};if(c.json.start){c.start={x:c.json.start.x===undefined?false:c.json.start.x,y:c.json.start.y===undefined?false:c.json.start.y}}else{c.start={x:false,y:false}}if(c.json.end){c.end={x:c.json.end.x===undefined?false:c.json.end.x,y:c.json.end.y===undefined?false:c.json.end.y}}else{c.end={x:false,y:false}}if(c.json.increment){c.increment={x:c.json.increment.x||1,y:c.json.increment.y||1,z:c.json.increment.z||0.05};if(c.json.increment.display){c.increment.display={x:c.json.increment.display.x||"number",y:c.json.increment.display.y||"number"}}else{c.increment.display={x:"number",y:"number"}}}else{c.increment={x:1,y:1,z:0.05,display:{x:"number",y:"number"}}}if(c.json.prefix){c.prefix={x:c.json.prefix.x||"",y:c.json.prefix.y||""}}else{c.prefix={x:"",y:""}}if(c.json.suffix){c.suffix={x:c.json.suffix.x||"",y:c.json.suffix.y||""}}else{c.suffix={x:"",y:""}}c.itemvars=c.json.items||[]};c.setupVars=function(){c.setupMinMax();c.setupRange();c.setupScale();c.setupMod();c.setupLightDepth()};c.setupScene=function(){c.addBorders();c.addMarks();c.addTitles()};c.setupControls=function(){c.controller.setupControls(c);c.setupCamera();c.update()};c.clear=function(){var e,d=c.nodes.length;for(e=0;e<d;e++){c.removeNode(c.nodes[e]);c.nodes[e]=undefined}c.removeNode(c.light)};c.setupMinMax=function(){var g,e,f,h,d,k;c.min={x:0,y:0};c.max={x:0,y:0};c.range={x:0,y:0};c.mod={x:0,y:0};f=c.itemvars.length;if(f&&c.itemvars[0].values&&c.itemvars[0].values.length){c.min.y=c.max.y=c.itemvars[0].values[0]}c.maxvlen=0;for(g=0;g<f;g++){h=c.itemvars[g].values.length||0;c.maxvlen=Math.max(c.maxvlen,h);for(e=0;e<h;e++){d=e;k=c.itemvars[g].values[e];c.min.x=Math.min(d,c.min.x);c.min.y=Math.min(k,c.min.y);c.max.x=Math.max(d,c.max.x);c.max.y=Math.max(k,c.max.y)}}if(c.start.x!==false&&c.start.x<c.min.x){c.min.x=c.start.x}if(c.start.y!==false&&c.start.y<c.min.y){c.min.y=c.start.y}if(c.end.y!==false&&c.end.y>c.max.y){c.max.y=c.end.y}};c.setupRange=function(){c.range.x=c.max.x-c.min.x;c.range.y=c.max.y-c.min.y};c.setupScale=function(){var d=THREEDCHARTS.CHARTSIZE/(c.range.y*c.scale.x);c.scale.x=THREEDCHARTS.CHARTSIZE/(c.range.x*c.scale.y);c.scale.y=d};c.setupMod=function(){c.mod.x=c.range.x*0.5+c.min.x;c.mod.y=c.range.y*0.5+c.min.y};c.addBorders=function(){var f=THREEDCHARTS.LINETHICKNESS*2,d={x:c.range.x*c.scale.x,y:c.range.y*c.scale.y},e=c.itemvars.length;if(c.border.back){c.addNode(new THREEDCHARTS.Plane({controller:c.controller,width:d.x+f,height:d.y+f,z:-c.increment.z,color:c.border.color}))}if(c.border.side){c.addNode(new THREEDCHARTS.Plane({controller:c.controller,direction:"y",width:c.increment.z*(e+1),height:d.y+f,x:-0.5*d.x-THREEDCHARTS.LINETHICKNESS,z:0.5*(c.increment.z*(e-1)-THREEDCHARTS.PLANETHICKNESS),color:c.border.color}))}if(c.border.bottom){c.addNode(new THREEDCHARTS.Plane({controller:c.controller,direction:"x",width:d.x+THREEDCHARTS.PLANETHICKNESS*2.5,height:c.increment.z*(e+1),x:-0.25*THREEDCHARTS.PLANETHICKNESS,y:-0.5*d.y-THREEDCHARTS.LINETHICKNESS,z:0.5*(c.increment.z*(e-1)-THREEDCHARTS.PLANETHICKNESS),color:c.border.color}))}};c.addMarks=function(){var g,e,d,j,h,f=c.itemvars.length;h=c.increment.z*(f+1)*0.5;if(c.marks.x){g=10/(c.maxvlen-1);for(i=0;i<c.maxvlen;i++){d=i*g-5;c.addMark({x:d,y:-5.175,z:h,endx:d,endy:-5.075,endz:h,color:c.colorscheme.marks});c.addTitle(c.getFormattedTitle(i,"x"),"center",{x:d,y:-5.4,z:h},0.15,0,c.colorscheme.titles)}}if(c.marks.y){e=c.range.y/c.increment.y;g=10/e;for(i=0;i<=e;i++){j=i*g-5;c.addMark({x:-5.175,y:j,z:h,endx:-5.075,endy:j,endz:h,color:c.colorscheme.marks});c.addTitle(c.getFormattedTitle(i,"y"),"right",{x:-5.3,y:j,z:h},0.15,0,c.colorscheme.titles)}}};c.addMark=function(d){c.addNode(new THREEDCHARTS.Line({controller:c.controller,x:d.x,y:d.y,z:d.z,endx:d.endx,endy:d.endy,endz:d.endz,color:d.color}))};c.hideGroup=function(f){var e,d;f=c.groups[f];d=f.length;for(e=0;e<d;e++){f[e].hide()}};c.showGroup=function(f){var e,d;f=c.groups[f];d=f.length;for(e=0;e<d;e++){f[e].show()}};c.addItem=function(d,e){if(c.groups[e]){c.groups[e][c.groups[e].length]=d}else{c.groups[e]=[d]}c.items[c.items.length]=d;c.addNodeGroup(d)};c.addTitles=function(){if(c.title.main&&c.titles.main){c.addTitle(c.title.main,"center",{x:0,y:5.75},0.6,0)}if(c.title.x&&c.titles.x){c.addTitle(c.title.x,"center",{x:0,y:-6.25},0.3,0)}if(c.title.y&&c.titles.y){c.addTitle(c.title.y,"center",{x:-6.25,y:0},0.3,Math.PI*0.5)}};c.addTitle=function(j,f,d,h,g,e){c.addNode(new THREEDCHARTS.Text({controller:c.controller,text:j,justify:f,x:d.x||0,y:d.y||0,z:d.z||0,size:h,rotation:g,color:e||c.colorscheme.titles}))};c.getFormattedTitle=function(g,e){var h,d,f;d=c.increment[e]*g;f=e==="x"?c.start.x:c.min.y;switch(c.increment.display[e]){case"month":h=THREEDCHARTS.MONTH[(f+d-1)%12];break;case"mon":h=THREEDCHARTS.MONTH[(f+d-1)%12].substring(0,3);break;case"number":default:h=f+d;break}return c.prefix[e]+h+c.suffix[e]};c.setupCamera=function(){c.controller.setCameraDistance(THREEDCHARTS.CAMERADISTANCE)};c.resetCamera=function(){c.controller.resetCamera()};c.setupLightDepth=function(){c.light.setDepth(c.increment.z*c.itemvars.length)};c.addNode=function(d){c.nodes[c.nodes.length]=d;c.scene.add(d.mesh)};c.addNodeGroup=function(f){var e,d=f.getLength();for(e=0;e<d;e++){c.addNode(f.getNode(e))}};c.removeNode=function(d){c.scene.remove(d.mesh)};c.update=function(){c.controller.update()};a()};THREEDCHARTS.LineChart=function(b){THREEDCHARTS.Chart.call(this,b);var c=this;function a(){c.setupJSON();c.setupVars();c.setupScene();c.addItems();c.setupControls()}c.addItems=function(){var l,e,h,g,f,n,m,o,d;e=c.itemvars.length;d=[];g=0;for(l=0;l<e;l++){f={controller:c.controller,values:[],width:0.05};n=c.itemvars[l].values.length;m=c.increment.z*l;for(h=0;h<n;h++){f.values[h]={x:(h-c.mod.x)*c.scale.x,y:(c.itemvars[l].values[h]-c.mod.y)*c.scale.y,z:m}}o=c.itemvars[l].group||c.itemvars[l].name;if(d[o]===undefined){d[o]=c.colorscheme.colors[g%c.colorscheme.colors.length];g++}f.name=c.itemvars[l].name;f.values.color=d[o];c.addItem(new THREEDCHARTS.LineItem(f),o)}};a()};THREEDCHARTS.ScatterChart=function(b){THREEDCHARTS.Chart.call(this,b);var c=this;function a(){c.setupJSON();c.setupVars();c.setupScene();c.addItems();c.setupControls()}c.setupMinMax=function(){var g,e,f,h,d,k;c.min={x:0,y:0};c.max={x:0,y:0};c.range={x:0,y:0};c.mod={x:0,y:0};f=c.itemvars.length;if(f&&c.itemvars[0].values){c.min.x=c.max.x=c.itemvars[0].values.x;c.min.y=c.max.y=c.itemvars[0].values.y}c.maxvlen=2;for(g=0;g<f;g++){d=c.itemvars[g].values.x;k=c.itemvars[g].values.y;c.min.x=Math.min(d,c.min.x);c.min.y=Math.min(k,c.min.y);c.max.x=Math.max(d,c.max.x);c.max.y=Math.max(k,c.max.y)}if(c.start.x!==false&&c.start.x<c.min.x){c.min.x=c.start.x}if(c.end.x!==false&&c.end.x>c.max.x){c.max.x=c.end.x}if(c.start.y!==false&&c.start.y<c.min.y){c.min.y=c.start.y}if(c.end.y!==false&&c.end.y>c.max.y){c.max.y=c.end.y}};c.addBorders=function(){var f=THREEDCHARTS.LINETHICKNESS*2,d={x:c.range.x*c.scale.x,y:c.range.y*c.scale.y},e=c.itemvars.length;if(c.border.back){c.addNode(new THREEDCHARTS.Plane({controller:c.controller,width:d.x+f,height:d.y+f,z:-c.increment.z,color:c.border.color}))}if(c.border.side){c.addNode(new THREEDCHARTS.Plane({controller:c.controller,direction:"y",width:c.increment.z*7,height:d.y+f,x:-0.5*d.x-THREEDCHARTS.LINETHICKNESS,z:0.5*(c.increment.z*5-THREEDCHARTS.PLANETHICKNESS),color:c.border.color}))}if(c.border.bottom){c.addNode(new THREEDCHARTS.Plane({controller:c.controller,direction:"x",width:d.x+THREEDCHARTS.PLANETHICKNESS*2.5,height:c.increment.z*7,x:-0.25*THREEDCHARTS.PLANETHICKNESS,y:-0.5*d.y-THREEDCHARTS.LINETHICKNESS,z:0.5*(c.increment.z*5-THREEDCHARTS.PLANETHICKNESS),color:c.border.color}))}};c.addMarks=function(){var g,f,e,j,h,d;h=c.increment.z*3.5;if(c.marks.x){d=c.range.x/c.increment.x+1;g=10/(d-1);for(i=0;i<d;i++){e=i*g-5;if(e<=0.5*THREEDCHARTS.CHARTSIZE){c.addMark({x:e,y:-5.175,z:h,endx:e,endy:-5.075,endz:h,color:c.colorscheme.marks});c.addTitle(c.getFormattedTitle(i,"x"),"center",{x:e,y:-5.4,z:h},0.15,0,c.colorscheme.titles)}}}if(c.marks.y){f=c.range.y/c.increment.y;g=10/f;for(i=0;i<=f;i++){j=i*g-5;c.addMark({x:-5.175,y:j,z:h,endx:-5.075,endy:j,endz:h,color:c.colorscheme.marks});c.addTitle(c.getFormattedTitle(i,"y"),"right",{x:-5.3,y:j,z:h},0.15,0,c.colorscheme.titles)}}};c.addItems=function(){var g,f,e,j,h,d;f=c.itemvars.length;d=[];e=0;for(g=0;g<f;g++){j={controller:c.controller,values:[],width:0.075};j.values[0]={x:(c.itemvars[g].values.x-c.mod.x)*c.scale.x,y:(c.itemvars[g].values.y-c.mod.y)*c.scale.y,z:c.increment.z*4};h=c.itemvars[g].group||c.itemvars[g].name;if(d[h]===undefined){d[h]=c.colorscheme.colors[e%c.colorscheme.colors.length];e++}j.name=c.itemvars[g].name;j.values.color=d[h];c.addItem(new THREEDCHARTS.ScatterItem(j),h)}};a()};THREEDCHARTS.Light=function(b){THREEDCHARTS.Node.call(this,b);var c=this;function a(){c.mesh=new THREE.DirectionalLight(16777215);c.castShadow();c.setDepth(b.depth||THREEDCHARTS.LIGHTDEPTH)}c.setDepth=function(d){c.mesh.position.set(0,0,d*2);c.mesh.shadowCameraNear=0;c.mesh.shadowCameraFar=d*2.5;c.mesh.shadowCameraLeft=-5.1;c.mesh.shadowCameraRight=5.1;c.mesh.shadowCameraTop=5.1;c.mesh.shadowCameraBottom=-5.1};c.lookAt=function(d,f,e){c.mesh.target.position.set(d,f,e)};a()};THREEDCHARTS.Node=function(b){var c=this;function a(){c.controller=b.controller;c.mesh=new THREE.Mesh(new THREE.CubeGeometry(10,10,10),new THREE.MeshLambertMaterial({color:7829367}));c.controller.update()}c.hide=function(){c.mesh.visible=false;c.controller.update()};c.show=function(){c.mesh.visible=true;c.controller.update()};c.castShadow=function(){c.mesh.castShadow=true};c.receiveShadow=function(){c.mesh.receiveShadow=true};c.getGeometry=function(){return c.mesh.geometry};c.setGeometry=function(d){c.mesh.geometry=d};c.setColor=function(d){c.mesh.material.color=d};c.adjustRotation=function(d,f,e){c.mesh.rotation.x+=d;c.mesh.rotation.y+=f;c.mesh.rotation.z+=e;c.controller.update()};c.setRotation=function(d,f,e){c.mesh.rotation.x=d;c.mesh.rotation.y=f;c.mesh.rotation.z=e;c.controller.update()};c.adjustPosition=function(d,f,e){c.mesh.position.x+=d;c.mesh.position.y+=f;c.mesh.position.z+=e;c.controller.update()};c.setPosition=function(d,f,e){c.mesh.position.x=d;c.mesh.position.y=f;c.mesh.position.z=e;c.controller.update()};c.adjustX=function(d){c.mesh.position.x+=d;c.controller.update()};c.setX=function(d){c.mesh.position.x=d;c.controller.update()};c.adjustY=function(d){c.mesh.position.y+=d;c.controller.update()};c.setY=function(d){c.mesh.position.y=d;c.controller.update()};c.adjustZ=function(d){c.mesh.position.z+=d;c.controller.update()};c.setZ=function(d){c.mesh.position.z=d;c.controller.update()};a()};THREEDCHARTS.NodeGroup=function(b){var c=this;function a(){c.controller=b.controller;c.nodes=[]}c.hide=function(){var e,d=c.nodes.length;for(e=0;e<d;e++){c.nodes[e].hide()}};c.show=function(){var e,d=c.nodes.length;for(e=0;e<d;e++){c.nodes[e].show()}};c.addNode=function(d){c.nodes[c.nodes.length]=d};c.getNode=function(d){return c.nodes[d]};c.getLength=function(){return c.nodes.length};c.castShadow=function(){var e,d=c.nodes.length;for(e=0;e<d;e++){c.nodes[e].castShadow=true}};c.receiveShadow=function(){var e,d=c.nodes.length;for(e=0;e<d;e++){c.nodes[e].receiveShadow=true}};c.adjustPosition=function(e,h,g){var f,d=c.nodes.length;for(f=0;f<d;f++){c.nodes[f].mesh.position.x+=e;c.nodes[f].mesh.position.y+=h;c.nodes[f].mesh.position.z+=g}c.controller.update()};a()};THREEDCHARTS.Joint=function(b){THREEDCHARTS.Node.call(this,b);var c=this;function a(){var d=b.size||THREEDCHARTS.JOINTTHICKNESS,e=b.smoothness||10;c.mesh=new THREE.Mesh(new THREE.CylinderGeometry(d,d,d*2,e,e,false),new THREE.MeshLambertMaterial({color:b.color}));c.mesh.position.x=b.x||0;c.mesh.position.y=b.y||0;c.mesh.position.z=b.z||0;c.mesh.rotation.x=0.5*Math.PI;c.castShadow();c.receiveShadow()}a()};THREEDCHARTS.Line=function(b){THREEDCHARTS.Node.call(this,b);var c=this;function a(){var h={x:b.x||0,y:b.y||0,z:b.z||0},g={x:b.endx||0,y:b.endy||0,z:b.endz||0},f=Math.sqrt(Math.pow(g.x-h.x,2)+Math.pow(g.y-h.y,2)),e=b.size||0.05,d=b.color;c.mesh=new THREE.Mesh(new THREE.CubeGeometry(e,f,e),new THREE.MeshLambertMaterial({color:d}));c.mesh.geometry.applyMatrix(new THREE.Matrix4().makeTranslation(0,0.5*f,0));c.mesh.position.x=h.x;c.mesh.position.y=h.y;c.mesh.position.z=h.z;if(h.x<g.x){c.mesh.rotation.z=-0.5*Math.PI+Math.asin((g.y-h.y)/f)}else{c.mesh.rotation.z=0.5*Math.PI+Math.asin((h.y-g.y)/f)}c.castShadow();c.receiveShadow()}a()};THREEDCHARTS.Plane=function(b){THREEDCHARTS.Node.call(this,b);var c=this;function a(){var h={x:b.x||0,y:b.y||0,z:b.z||0},g=b.direction||"z",f=b.width||10,d=b.height||10,e=b.color;c.mesh=new THREE.Mesh(new THREE.CubeGeometry(f,d,THREEDCHARTS.PLANETHICKNESS),new THREE.MeshLambertMaterial({color:e}));c.mesh.position.x=h.x;c.mesh.position.y=h.y;c.mesh.position.z=h.z;switch(g){case"x":c.mesh.rotation.x=0.5*Math.PI;break;case"y":c.mesh.rotation.y=0.5*Math.PI;break;default:case"z":break}c.castShadow();c.receiveShadow()}a()};THREEDCHARTS.Point=function(b){THREEDCHARTS.Node.call(this,b);var c=this;function a(){var d=b.x||0,j=b.y||0,h=b.z||0,f=b.size||THREEDCHARTS.POINTSIZE,g=b.smoothness||50,e=b.color;c.mesh=new THREE.Mesh(new THREE.SphereGeometry(f,g,g),new THREE.MeshLambertMaterial({color:e}));c.mesh.position.x=d;c.mesh.position.y=j;c.mesh.position.z=h;c.castShadow();c.receiveShadow()}a()};THREEDCHARTS.Text=function(b){THREEDCHARTS.Node.call(this,b);var c=this;function a(){var k=b.text+""||"-",f=b.justify||"left",d=b.x||0,l=b.y||0,j=b.z||0,h=b.size||1,e=b.color,g=b.rotation||0;c.mesh=new THREE.Mesh(new THREE.TextGeometry(k,{font:"helvetiker",size:h,height:0.1,curveSegments:10,weight:"normal",style:"normal"}),new THREE.MeshLambertMaterial({color:e}));c.mesh.geometry.computeBoundingBox();if(f==="right"){c.mesh.geometry.applyMatrix(new THREE.Matrix4().makeTranslation(-(c.mesh.geometry.boundingBox.max.x-c.mesh.geometry.boundingBox.min.x),-(c.mesh.geometry.boundingBox.max.y-c.mesh.geometry.boundingBox.min.y)*0.5,0))}else{if(f==="center"){c.mesh.geometry.applyMatrix(new THREE.Matrix4().makeTranslation(-(c.mesh.geometry.boundingBox.max.x-c.mesh.geometry.boundingBox.min.x)*0.5,-(c.mesh.geometry.boundingBox.max.y-c.mesh.geometry.boundingBox.min.y)*0.5,0))}else{c.mesh.geometry.applyMatrix(new THREE.Matrix4().makeTranslation(0,-(c.mesh.geometry.boundingBox.max.y-c.mesh.geometry.boundingBox.min.y)*0.5,0))}}c.mesh.position.x=d;c.mesh.position.y=l;c.mesh.position.z=j;c.mesh.rotation.z=g;c.castShadow();c.receiveShadow()}a()};THREEDCHARTS.BarItem=function(b){THREEDCHARTS.Item.call(this,b);var c=this;function a(){if(c.values.length>0){c.addNode(new THREEDCHARTS.Plane({controller:c.controller,x:c.values[0].x,y:c.values[0].y,z:c.values[0].z,width:c.width,height:c.height,direction:"z",color:c.values.color}))}}a()};THREEDCHARTS.Item=function(b){THREEDCHARTS.NodeGroup.call(this,b);var c=this;function a(){c.name=b.name||"";c.values=b.values||[];c.width=b.width;c.height=b.height;c.color=b.color}a()};THREEDCHARTS.LineItem=function(b){THREEDCHARTS.Item.call(this,b);var c=this;function a(){var e,d=c.values.length,f;if(d>0){f={x:c.values[0].x,y:c.values[0].y,z:c.values[0].z};for(e=1;e<d;e++){c.addLine({x:f.x,y:f.y,z:f.z,endx:c.values[e].x,endy:c.values[e].y,endz:c.values[e].z,size:c.width,color:c.values.color});f={x:c.values[e].x,y:c.values[e].y,z:c.values[e].z}}}}c.addLine=function(d){c.addNode(new THREEDCHARTS.Line({controller:c.controller,x:d.x,y:d.y,z:d.z,endx:d.endx,endy:d.endy,endz:d.endz,size:d.size,color:d.color}));c.addNode(new THREEDCHARTS.Joint({controller:c.controller,x:d.endx,y:d.endy,z:d.endz,size:d.size/2,color:d.color}))};a()};THREEDCHARTS.ScatterItem=function(b){THREEDCHARTS.Item.call(this,b);var c=this;function a(){if(c.values.length>0){c.addNode(new THREEDCHARTS.Joint({controller:c.controller,x:c.values[0].x,y:c.values[0].y,z:c.values[0].z,size:c.width,color:c.values.color}))}}a()};THREEDCHARTS.Controls=function(b){var c=this;function a(){c.gui=new THREEDCHARTS.GUI({controller:b.controller,gui:b.gui});c.mouse=new THREEDCHARTS.Mouse({controller:b.controller,radius:b.radius,zoom:b.zoom,minzoom:b.minzoom,maxzoom:b.maxzoom});c.keyboard=new THREEDCHARTS.Keyboard({controller:b.controller})}c.setRadius=function(d){c.mouse.setRadius(d)};a()};THREEDCHARTS.GUI=function(b){var c=this;function a(){c.gui=b.gui;c.setLegend({controller:b.controller,size:c.gui.size});if(b.gui.tools){c.tools=new THREEDCHARTS.Tools({controller:b.controller,size:c.gui.size})}}c.setLegend=function(d){if(c.gui.legend){c.legend=new THREEDCHARTS.Legend(d)}};a()};THREEDCHARTS.Keyboard=function(d){var e=this;function a(){e.controller=d.controller;e.canvas=e.controller.canvas;e.canvas.addEventListener("keydown",b,false);e.canvas.addEventListener("keyup",c,false)}function b(f){switch(f.keyCode){default:break}}function c(f){switch(f.keyCode){default:break}}a()};THREEDCHARTS.Legend=function(d){var e=this;function a(){var j,l,k,f,g,h;e.controller=d.controller;e.container=e.controller.container;e.canvas=e.controller.canvas;e.width=e.canvas.clientWidth;e.height=e.canvas.clientHeight;e.size=d.size||1;e.chart=e.controller.chart;e.groups=e.chart.groups;e.camera=e.controller.camera;e.html=document.createElement("div");e.html.setAttribute("class","gui legend");e.html.style.fontSize=e.size+"em";e.locked=false;e.lock=document.createElement("a");e.lock.setAttribute("class","lock");e.lock.setAttribute("href","javascript:void(0)");e.lock.addEventListener("click",b,false);e.html.appendChild(e.lock);j=0;for(l in e.groups){k=document.createElement("div");k.setAttribute("class","key on");k.setAttribute("data-group",l);k.addEventListener("click",c,false);f=document.createElement("a");f.setAttribute("class","color");f.style.backgroundColor="#"+e.controller.colorscheme.colors[j%e.controller.colorscheme.colors.length].toString(16);f.setAttribute("href","javascript:void(0)");k.appendChild(f);g=document.createElement("a");g.setAttribute("class","name");g.setAttribute("href","javascript:void(0)");g.innerHTML=l;k.appendChild(g);e.html.appendChild(k);j++}e.container.appendChild(e.html)}e.clear=function(){e.container.removeChild(e.html)};function c(){if(this.getAttribute("class")==="key on"){this.setAttribute("class","key off");e.chart.hideGroup(this.getAttribute("data-group"))}else{this.setAttribute("class","key on");e.chart.showGroup(this.getAttribute("data-group"))}}function b(){if(e.locked){e.html.setAttribute("class","gui legend")}else{e.html.setAttribute("class","gui legend locked")}e.locked=!e.locked}a()};THREEDCHARTS.Mouse=function(f){var g=this;function b(){g.controller=f.controller;g.container=g.controller.container;g.canvas=g.controller.canvas;g.radius=f.radius;g.setRadius(g.radius);g.width=g.canvas.clientWidth;g.height=g.canvas.clientHeight;g.chart=g.controller.chart;g.camera=g.controller.camera;g.mouse={theta:0,phi:0,x:0,y:0,down:false};g.theta=0;g.phi=0;if(g.controller.webgl){g.canvas.addEventListener("mousemove",d,false);g.canvas.addEventListener("mousedown",c,false);g.canvas.addEventListener("mouseup",e,false);g.canvas.addEventListener("mousewheel",a,false);g.canvas.addEventListener("DOMMouseScroll",a,false)}}function d(h){if(g.mouse.down){g.theta=-((h.clientX-g.mouse.x)*0.5)+g.mouse.theta;g.phi=((h.clientY-g.mouse.y)*0.5)+g.mouse.phi;g.theta=Math.min(135,Math.max(-135,g.theta));g.phi=Math.min(135,Math.max(-135,g.phi));g.camera.position.x=g.radius*Math.sin(g.theta*Math.PI/360)*Math.cos(g.phi*Math.PI/360);g.camera.position.y=g.radius*Math.sin(g.phi*Math.PI/360);g.camera.position.z=g.radius*Math.cos(g.theta*Math.PI/360)*Math.cos(g.phi*Math.PI/360);g.controller.update()}}function c(h){h.preventDefault();g.mouse={theta:g.theta,phi:g.phi,x:h.clientX,y:h.clientY,down:true}}function e(h){g.mouse.down=false;g.mouse.x=h.clientX-g.mouse.x;g.mousey=h.clientY-g.mouse.y}function a(h){g.radius+=(h.detail<0||h.wheelDelta>0)?-g.zoom:g.zoom;g.radius=Math.max(g.minzoom,Math.min(g.maxzoom,g.radius));g.camera.position.x=g.radius*Math.sin(g.theta*Math.PI/360)*Math.cos(g.phi*Math.PI/360);g.camera.position.y=g.radius*Math.sin(g.phi*Math.PI/360);g.camera.position.z=g.radius*Math.cos(g.theta*Math.PI/360)*Math.cos(g.phi*Math.PI/360);g.controller.update()}g.setRadius=function(h){g.theta=0;g.phi=0;g.radius=h;g.zoom=1;g.minzoom=h*0.4;g.maxzoom=h*2.5;g.controller.update()};b()};THREEDCHARTS.Tools=function(c){var g=this;function k(){var p,m,t,o,s,q,n,r;g.controller=c.controller;g.container=g.controller.container;g.canvas=g.controller.canvas;g.width=g.canvas.clientWidth;g.height=g.canvas.clientHeight;g.size=c.size||1;g.chart=g.controller.chart;g.items=g.chart.items;g.camera=g.controller.camera;g.html=document.createElement("div");g.html.setAttribute("class","gui tools");g.html.style.fontSize=g.size+"em";g.container.appendChild(g.html);g.options={};g.open=false;o=document.createElement("a");o.setAttribute("class","icon tools");o.setAttribute("href","javascript:void(0)");o.addEventListener("click",a,false);g.html.appendChild(o);n=[{type:"files",icon:"forward",text:"Open File",click:function(){h("files")}},{type:"reset",icon:"reset",text:"Reset View",click:function(){g.chart.resetCamera();a()}},{type:"about",icon:"about",text:"About",click:function(){l();a()}}];j({name:"main",current:true,back:false,options:n});q=g.controller.files;n=[];m=q.length;for(p=0;p<m;p++){t=q[p].lastIndexOf("/");r=q[p].substring(t+1);t=r.lastIndexOf(".");if(t===-1){r=r.substring(0)}else{r=r.substring(0,t)}r=r.replace("_"," ");n[n.length]={type:"open",icon:"open",text:r,click:e,params:{index:p}}}j({name:"files",current:false,back:"main",options:n});g.aboutopen=true;g.about=document.createElement("div");g.about.setAttribute("class","gui about show");g.about.style.fontSize=g.size+"em";g.about.innerHTML='<a class="logo" href="'+THREEDCHARTS.WEBSITE+'"></a><h2>About <a href="'+THREEDCHARTS.WEBSITE+'">ThreeDCharts.JS</a></h2><p>Version: '+THREEDCHARTS.VERSION+" ["+THREEDCHARTS.DATE+']</p><p>3D Charts using <a href="http://threejs.org/">Three.JS</a> / <a href="http://get.webgl.org/">WebGL</a>.</p><p>Developed by <a href="http://mphennum.com/">MPHennum</a>.</p><p><a href="'+THREEDCHARTS.WEBSITE+'">'+THREEDCHARTS.WEBSITE+"</a></p>";g.container.appendChild(g.about);g.about.style.top=(g.container.offsetHeight-g.about.offsetHeight)*0.5+"px";g.about.style.left=(g.container.offsetWidth-g.about.offsetWidth)*0.5+"px";l();s=document.createElement("a");s.setAttribute("class","icon close");s.setAttribute("href","javascript:void(0)");s.addEventListener("click",l,false);g.about.appendChild(s)}function l(){if(g.aboutopen){g.about.setAttribute("class","gui about hide")}else{g.about.setAttribute("class","gui about show")}g.aboutopen=!g.aboutopen}function h(m){g.options.current.setAttribute("class",g.options.current.getAttribute("class").replace(" show"," hide"));g.options.current=g.options[m];g.options.current.setAttribute("class",g.options.current.getAttribute("class").replace(" hide"," show"));g.open=true}function a(){if(g.open){g.options.current.setAttribute("class",g.options.current.getAttribute("class").replace(" show"," hide"))}else{g.options.current=g.options.main;g.options.main.setAttribute("class","options main show")}g.open=!g.open}function e(m){a();g.controller.loadFile(m.index)}function j(s){var p=s.name,n=s.back||false,r=s.current||false,o=s.options||[],q,m=o.length;g.options[p]=document.createElement("div");g.options[p].setAttribute("class","options "+p+" hide");if(r){g.options.current=g.options[p]}if(n){d(g.options[p],"back","back","back",function(){h(n)})}g.html.appendChild(g.options[p]);for(q=0;q<m;q++){d(g.options[p],o[q].type,o[q].icon,o[q].text,o[q].click,o[q].params)}}function d(q,p,o,t,r,s){var n,m;n=document.createElement("a");n.setAttribute("class","option "+p);n.setAttribute("href","javascript:void(0)");if(r){if(s){n.addEventListener("click",function(){r(s)},false)}else{n.addEventListener("click",r,false)}}q.appendChild(n);b(n,o);f(n,t)}function b(o,n){var m;m=document.createElement("span");m.setAttribute("class","icon "+n);o.appendChild(m)}function f(m,n){var o;o=document.createElement("span");o.setAttribute("class","text");o.innerHTML=n;m.appendChild(o)}k()};